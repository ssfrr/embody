#!/usr/bin/env python

'''embody

Tools for embedded C development. Currently just generates fake implementations
from C header files.

Usage:
 embody fake [options] <header> [-- <cpp_args>...]
 embody --help

Options:
 -d <outdir>, --outdir=<outdir>     Directory for generated header and source
 -s <outsrc>, --outsrc=<outsrc>     Filename for generated source file
                                    (Overrides -d option)
 -h <outhead>, --outhead=<outhead>  Filename for generated header file
                                    (Overrides -d option)
 -p <prefix>, --prefix=<prefix>     Prefix for generated file (default: Fake)
 -v, --verbose                      Print extra info
'''

from docopt import docopt
import embody
import coloredlogs
import logging

logger = logging.getLogger()
logger.addHandler(coloredlogs.ColoredStreamHandler(
    show_name=False,
    show_severity=False,
    show_timestamps=False,
    show_hostname=False))
logger.setLevel(logging.INFO)

def main(args):
    if args['--verbose']:
        logger.setLevel(logging.DEBUG)
    in_filename = args['<header>']
    out_dir = args['--outdir']
    out_src = args['--outsrc']
    out_header = args['--outhead']
    prefix = args['--prefix']
    cpp_args = args['<cpp_args>']
    if len(cpp_args) > 0 and cpp_args[0] == '--':
        cpp_args = cpp_args[1:]
    try:
        embody.generate_fake(in_filename, out_dir, out_src, out_header,
                            prefix, cpp_args=cpp_args)
    except Exception as e:
        logger.error(e)


if __name__ == '__main__':
    args = docopt(__doc__)
    main(args)
